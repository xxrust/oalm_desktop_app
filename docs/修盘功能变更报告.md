# 修盘（grid）数据接入变更报告（前端）

## 1. 页面入口

- 左侧菜单新增“修盘数据”，路由为 `/grid`
- 代码位置：`oalm_desktop_app/src/App.vue`、`oalm_desktop_app/src/router/index.ts`

## 2. 前端页面实现

页面：`oalm_desktop_app/src/views/Grid.vue`

实现内容：

- 筛选条件：
  - `设备ID`（来源：`/api/devices`）
  - `修盘方式(grid_mod)`（来源：`/api/grid/options`）
  - `时间范围`（按修盘 `start_time` 的日期过滤）
  - `条数 limit`
- 表格展示 `grid` 表记录字段：`id/device_id/grid_mod/set_round/start_time/end_time/duration/round_num/end_way`
- 分析图表（修盘后 24h 批次质量变化）：
  - 调用既有接口：`GET /api/analysis/repair-effect`
  - 参数：`deviceId + repairMethod(grid_mod)`
  - 展示：`batch_number` 对应的 `avg_stdev/std_stdev/batch_count`
  - 新增参数：`maxBatches`（最多统计修盘后的第 N 盘，默认 30）

## 3. API 封装与 Store 改动

### 3.1 API 封装

文件：`oalm_desktop_app/src/api/index.ts`

- 新增：
  - `getGridRecords(params) -> GET /api/grid`
  - `getGridOptions() -> GET /api/grid/options`
- 统一 baseURL：`http://127.0.0.1:5000/api`

### 3.2 Store

文件：`oalm_desktop_app/src/stores/grid.ts`

- 新增类型：`GridRecord`、`GridOptions`
- 新增方法：
  - `fetchGridRecords()`
  - `fetchGridOptions()`

## 4. 供客户研发二次开发的改动指南（前端）

### 4.1 增加表格列

1. 后端 `/api/grid` 返回中新增字段
2. 前端在 `Grid.vue` 增加一个 `el-table-column`（`prop` 对应字段名）

### 4.2 增加筛选项

1. 在 `filterForm` 增加字段
2. 表单里加一个 `el-form-item`
3. `fetchGrid()` 把参数传给 `gridStore.fetchGridRecords()`
4. 后端同步实现对应过滤条件

### 4.3 修盘方式展示为中文

建议做一张映射表（前端即可）：

- 例如：`{ 1: '方式A', 2: '方式B' }`
- 表格/下拉用映射后的 label 展示，value 仍传数值给后端

## 5. 本次版本信息

- 前端提交：`6385455 feat: add grid(修盘) data page`
